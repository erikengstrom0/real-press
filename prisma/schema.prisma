// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Content {
  id          String   @id @default(uuid())
  url         String   @unique
  domain      String
  title       String?
  description String?
  contentText String   @map("content_text")
  contentHash String   @map("content_hash")
  sourceType  String   @default("user_submitted") @map("source_type")
  status      String   @default("pending")
  createdAt   DateTime @default(now()) @map("created_at")

  aiScore     AiScore?
  media       ContentMedia[]

  @@map("content")
}

model AiScore {
  id              String   @id @default(uuid())
  contentId       String   @unique @map("content_id")
  compositeScore  Float    @map("composite_score")
  classification  String   // 'human', 'likely_human', 'unsure', 'likely_ai', 'ai'
  gptzeroScore    Float?   @map("gptzero_score")
  heuristicScore  Float?   @map("heuristic_score")
  createdAt       DateTime @default(now()) @map("created_at")

  // Multi-modal scoring fields
  textScore       Float?   @map("text_score")
  textConfidence  Float?   @map("text_confidence")
  imageScore      Float?   @map("image_score")
  imageConfidence Float?   @map("image_confidence")
  videoScore      Float?   @map("video_score")
  videoConfidence Float?   @map("video_confidence")
  analyzedTypes   String[] @default([]) @map("analyzed_types")

  content         Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@map("ai_scores")
}

model ContentMedia {
  id        String   @id @default(uuid())
  contentId String   @map("content_id")
  type      String   // 'image' | 'video'
  url       String?
  createdAt DateTime @default(now()) @map("created_at")

  content    Content     @relation(fields: [contentId], references: [id], onDelete: Cascade)
  mediaScore MediaScore?

  @@map("content_media")
}

model MediaScore {
  id           String   @id @default(uuid())
  mediaId      String   @unique @map("media_id")
  score        Float
  confidence   Float
  providerName String   @map("provider_name")
  createdAt    DateTime @default(now()) @map("created_at")

  media        ContentMedia @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@map("media_scores")
}
